<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>R语言选择导入文本数据部分字段 | 飞舞的尘埃</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    <link href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" rel="stylesheet">
  </head>

  <body>
    <nav>
    <ul class="menu">
      
      <li><a href="/">Home</a></li>
      
      <li><a href="/about/">About</a></li>
      
      <li><a href="/categories/">Categories</a></li>
      
      <li><a href="/tags/">Tags</a></li>
      
      <li><a href="/index.xml">Subscribe</a></li>
      
    </ul>
    <hr/>
    </nav>

<div class="article-meta">
<h1><span class="title">R语言选择导入文本数据部分字段</span></h1>
<h2 class="date">2015/02/06</h2>
<p class="terms">
  
  
  
  Categories:   
  
  <a href='/categories/r'>R</a>
  
  
  
  
  
  
  Tags:   
  
  <a href='/tags/data'>data</a>
  
  <a href='/tags/linux'>linux</a>
  
  <a href='/tags/%E6%80%A7%E8%83%BD'>性能</a>
  
  
  
  
</p>
</div>



<main>


<blockquote>
<p>背景：文本数据字段太多，只需要读取有用字段，以此降低内存压力方便分析</p>
</blockquote>

<h3 id="方法一-read-table-read-csv-指定列读取">方法一：<code>read.table、read.csv</code>指定列读取</h3>

<p>       直接使用自带函数设定适当的参数（<code>colClasses</code>），该参数需要指定每列数据的类型（可以使用<code>nrows</code>参数读取几行查看<code>class</code>），不需要的列指定为<code>NULL</code>即可。如下：</p>

<pre><code class="language-R">dat &lt;- structure(list(Year = 2009:2011, Jan = c(-41L, -41L, -21L), 
                      Feb = c(-27L, -27L, -27L), Mar = c(-25L, -25L, -2L), 
                      Apr = c(-31L, -31L, -6L), May = c(-31L, -31L, -10L), 
                      Jun = c(-39L, -39L, -32L), Jul = c(-25L, -25L, -13L), 
                      Aug = c(-15L, -15L, -12L), Sep = c(-30L, -30L, -27L), 
                      Oct = c(-27L, -27L, -30L), Nov = c(-21L, -21L, -38L), 
                      Dec = c(-25L, -25L, -29L)), 
                 .Names = c(&quot;Year&quot;, &quot;Jan&quot;, &quot;Feb&quot;, &quot;Mar&quot;, &quot;Apr&quot;, &quot;May&quot;, &quot;Jun&quot;, 
                            &quot;Jul&quot;, &quot;Aug&quot;, &quot;Sep&quot;, &quot;Oct&quot;, &quot;Nov&quot;, &quot;Dec&quot;), 
                 class = &quot;data.frame&quot;,
                 row.names = c(NA, -3L))
write.table(dat, &quot;test.txt&quot;, row.names=FALSE)

## 查看每个列的class
df &lt;- read.table(&quot;test.txt&quot;, nrow=2, header = TRUE)
apply(df, 2, class)
# Year       Jan       Feb       Mar       Apr       May       Jun       Jul       Aug       Sep       Oct       Nov       Dec 
# &quot;integer&quot; &quot;integer&quot; &quot;integer&quot; &quot;integer&quot; &quot;integer&quot; &quot;integer&quot; &quot;integer&quot; &quot;integer&quot; &quot;integer&quot; &quot;integer&quot; &quot;integer&quot; &quot;integer&quot; &quot;integer&quot;

df &lt;- read.table(&quot;test.txt&quot;, 
                 colClasses = c(rep(&quot;integer&quot;, 7), rep(&quot;NULL&quot;, 6)), 
                 header = TRUE)
# &gt; df
# Year Jan Feb Mar Apr May Jun
# 1 2009 -41 -27 -25 -31 -31 -39
# 2 2010 -41 -27 -25 -31 -31 -39
# 3 2011 -21 -27  -2  -6 -10 -32

write.csv(dat, &quot;test.csv&quot;, row.names=FALSE)
df &lt;- read.csv(&quot;test.csv&quot;, 
               colClasses = c(rep(&quot;integer&quot;, 7), rep(&quot;NULL&quot;, 6)), 
               header = TRUE)
# &gt; df
# Year Jan Feb Mar Apr May Jun
# 1 2009 -41 -27 -25 -31 -31 -39
# 2 2010 -41 -27 -25 -31 -31 -39
# 3 2011 -21 -27  -2  -6 -10 -32

</code></pre>

<h3 id="方法二-使用-package-colbycol">方法二：使用<code>package：colbycol</code></h3>

<p><a href="http://colbycol.r-forge.r-project.org/"><code>colbycol</code></a>没有安装成功，停止更新，好像也不怎么支持了</p>

<h3 id="方法三-使用其他-r-package-辅助实现-如-rjdbc-数据库操作">方法三：使用其他<code>R package</code>辅助实现（如<code>RJDBC</code>数据库操作）</h3>

<p>实际就是用<code>Java</code>来解决这个问题，需要安装配置多个环境，维护成本大、太复杂没有去实现</p>

<pre><code class="language-R">library(RJDBC)
write.table(x=mtcars, file=&quot;mtcars.csv&quot;, sep=&quot;,&quot;, row.names=F, col.names=T)

path.to.jdbc.driver &lt;- &quot;jdbc//csvjdbc-1.0-18.jar&quot;
drv &lt;- JDBC(&quot;org.relique.jdbc.csv.CsvDriver&quot;, path.to.jdbc.driver)
conn &lt;- dbConnect(drv, sprintf(&quot;jdbc:relique:csv:%s&quot;, getwd()))

head(dbGetQuery(conn, &quot;select * from mtcars&quot;), 3)
# mpg cyl disp  hp drat    wt  qsec vs am gear carb
# 1   21   6  160 110  3.9  2.62 16.46  0  1    4    4
# 2   21   6  160 110  3.9 2.875 17.02  0  1    4    4
# 3 22.8   4  108  93 3.85  2.32 18.61  1  1    4    1

head(dbGetQuery(conn, &quot;select mpg, gear from mtcars&quot;), 3)
</code></pre>

<h3 id="方法四-借助-linux-命令行工具实现">方法四：借助<code>linux</code>命令行工具实现</h3>

<p>快速，方便；需要熟悉<code>awk，cut</code>的语法</p>

<p><a href="http://www.cnblogs.com/dong008259/archive/2011/12/09/2282679.html"><code>cut</code></a>功能比较单一适合处理分割整齐的数据，而<code>awk</code>的功能更加强大（<a href="http://www.cnblogs.com/ggjucheng/archive/2013/01/13/2858470.html">awk使用1</a>，<a href="http://coolshell.cn/articles/9070.html">awk使用2</a>）</p>

<pre><code class="language-R">dat &lt;- structure(list(Year = 2009:2011, Jan = c(-41L, -41L, -21L), 
                      Feb = c(-27L, -27L, -27L), Mar = c(-25L, -25L, -2L), 
                      Apr = c(-31L, -31L, -6L), May = c(-31L, -31L, -10L), 
                      Jun = c(-39L, -39L, -32L), Jul = c(-25L, -25L, -13L), 
                      Aug = c(-15L, -15L, -12L), Sep = c(-30L, -30L, -27L), 
                      Oct = c(-27L, -27L, -30L), Nov = c(-21L, -21L, -38L), 
                      Dec = c(-25L, -25L, -29L)), 
                 .Names = c(&quot;Year&quot;, &quot;Jan&quot;, &quot;Feb&quot;, &quot;Mar&quot;, &quot;Apr&quot;, &quot;May&quot;, &quot;Jun&quot;, 
                            &quot;Jul&quot;, &quot;Aug&quot;, &quot;Sep&quot;, &quot;Oct&quot;, &quot;Nov&quot;, &quot;Dec&quot;), 
                 class = &quot;data.frame&quot;,
                 row.names = c(NA, -3L))
# 使用制表符分割
write.table(dat, &quot;test.txt&quot;, row.names=FALSE, sep = &quot;\t&quot;)
df &lt;- read.table(pipe(&quot;cut -f 1,5 test.txt&quot;), header=TRUE)
df
system(&quot;cut -f 1,5 test.txt&quot;)
# Year Apr
# 1 2009 -31
# 2 2010 -31
# 3 2011  -6

# 使用空格分割
write.table(dat, &quot;test.txt&quot;, row.names=FALSE, sep = &quot; &quot;)
df &lt;- read.table(pipe(&quot;cut -d ' ' -f 1,5 test.txt&quot;), header=TRUE)
df
system(&quot;cut -d ' ' -f 1,5 test.txt&quot;)
# Year Apr
# 1 2009 -31
# 2 2010 -31
# 3 2011  -6
</code></pre>

<h3 id="总结">总结</h3>

<ul>
<li>数据量不是很大且对数据内容了解时，可以使用read.table指定合理的参数colClasses读取。</li>
<li>数据较大且要求速度建议借助linux下的数据处理工具</li>
</ul>

<hr />

<p>参考：<a href="http://stackoverflow.com/questions/5788117/only-read-limited-number-of-columns-in-r">Only read limited number of columns in R</a></p>

</main>

  <footer>
  <script src="//yihui.name/js/math-code.js"></script>
<script async src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>

<script async src="//yihui.name/js/center-img.js"></script>

<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/r.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/python.min.js"></script>


<script>
hljs.configure({languages: []});
hljs.initHighlightingOnLoad();
</script>



<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-113712825-1', 'auto');
ga('send', 'pageview');
</script>




  <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "flydust" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>



  
  <hr/>
  &copy; <a href="https://xwydq.netlify.com/">大葱</a> 2017 &ndash; 2018 | <a href="https://github.com/xwydq">Github</a>
  
  </footer>
  </body>
</html>

